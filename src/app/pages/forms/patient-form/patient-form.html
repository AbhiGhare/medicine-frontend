<div class="card shadow-3 border-round p-6 max-w-5xl mx-auto"
     style="background: var(--surface-card); color: var(--text-color)">

  <h2 class="text-3xl font-bold text-center mb-6">
    Patient Billing Form
  </h2>

  <form [formGroup]="form" (ngSubmit)="submit()" class="flex flex-col gap-5">

    <!-- Patient Info -->
    <div class="p-5 border-1 border-round shadow-sm"
         style="background: var(--surface-0); border-color: var(--surface-border);">

      <h3 class="text-lg font-semibold mb-4" style="color: var(--text-color)">
        Patient Details
      </h3>

      <div class="grid gap-4 md:grid-cols-2">

        <div>
          <label class="font-medium" style="color: var(--text-color)">Patient Name</label>
          <input pInputText formControlName="patientName" class="w-full mt-1" />
        </div>

        <div>
          <label class="font-medium" style="color: var(--text-color)">Date</label>
          <p-datepicker 
            formControlName="date" 
            dateFormat="dd/MM/yy" 
            placeholder="Select Date"
            class="w-full mt-1" />
        </div>

        <div class="md:col-span-2">
          <label class="font-medium" style="color: var(--text-color)">Address</label>
          <input pInputText formControlName="address" class="w-full mt-1" />
        </div>

        <div class="md:col-span-2">
          <label class="font-medium" style="color: var(--text-color)">Mobile Number</label>
          <input pInputText formControlName="mobile" class="w-full mt-1" />
        </div>

      </div>
    </div>

    <!-- Items Table -->
    <div class="p-5 border-1 border-round shadow-sm"
         style="background: var(--surface-0); border-color: var(--surface-border);">

      <h3 class="text-lg font-semibold mb-3" style="color: var(--text-color)">
        Items
      </h3>

      <p-table [value]="items.controls"
               responsiveLayout="scroll"
               styleClass="p-datatable-gridlines border-round overflow-hidden"
               [style]="{ borderColor: 'var(--surface-border)' }">

        <ng-template pTemplate="header">
          <tr>
            <th class="text-center" style="color: var(--text-color)">Item Name</th>
            <th class="text-center" style="color: var(--text-color)">Quantity</th>
            <th class="text-center" style="color: var(--text-color)">Rate</th>
            <th class="text-center" style="color: var(--text-color)">Total</th>
            <th class="text-center" style="color: var(--text-color)">Action</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-row let-i="rowIndex">
          <tr [formGroup]="row">

            <td><input pInputText formControlName="item" class="w-full" /></td>

            <td>
              <input pInputText type="number"
                formControlName="quantity"
                (input)="calculateTotal()"
                class="w-full text-center" />
            </td>

            <td>
              <input pInputText type="number"
                formControlName="rate"
                (input)="calculateTotal()"
                class="w-full text-center" />
            </td>

            <td class="text-center font-semibold">
              {{ row.value.quantity * row.value.rate || 0 }}
            </td>

            <td class="text-center">
              <button pButton icon="pi pi-trash"
                (click)="removeItem(i)"
                severity="danger"
                class="p-button-sm"></button>
            </td>

          </tr>
        </ng-template>

      </p-table>

      <button pButton type="button"
              icon="pi pi-plus"
              label="Add Item"
              (click)="addItem()"
              class="mt-3"></button>
    </div>

    <!-- Total & Submit -->
    <div class="flex justify-end items-center gap-6 mt-4">
      <div class="text-2xl font-bold" style="color: var(--text-color)">
        Total Bill:
        <span style="color: var(--green-500); font-weight: 800;">
          â‚¹ {{ totalBill }}
        </span>
      </div>

      <button pButton type="submit"
              label="Submit Bill"
              class="p-button-lg p-button-success"></button>
    </div>

  </form>
</div>
